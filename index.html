<!-- RECO7609 Story Writer Webapp python backend server-->
<!--
Prompt:

Please update the code so when "End Story" is pressed and backend server ended, All the buttons are greyed out to indicate that they can't be pressed anymore

Please update the code so when "End Story" is pressed and backend server ended, the prediction box and auto complete box says "Story ended"


----------------------------------------------------------------------------------------------------------------------------------

-->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story Writer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #story-box, #next-word-box, #auto-complete-box { border: 1px solid #000; padding: 10px; margin-bottom: 10px; }
        #next-word-box { height: 20px; }
        #auto-complete-box { height: 20px; }
        .disabled { background-color: grey; cursor: not-allowed; }
    </style>
</head>
<body>
    <h1>Story Writer</h1>
    <div id="story-box">Your story will appear here...</div>
    <div id="next-word-box">I will predict your next word...</div>
    <input type="text" id="word-input" placeholder="Enter a word" oninput="autoComplete()">
    <button id="write-button" onclick="writeWord()">Write</button>
    <div id="auto-complete-box">Auto Complete</div>
    <button id="bigram-button" onclick="switchModel('bigram')">Use Bigram Model</button>
    <button id="trigram-button" onclick="switchModel('trigram')">Use Trigram Model</button>
    <button id="end-button" onclick="endStory()">End Story</button>

    <script>
        let modelType = 'bigram';  // Default model type

        function updateButtonText() {
            let wordInput = document.getElementById('word-input').value.trim();
            let writeButton = document.getElementById('write-button');
            let storyBox = document.getElementById('story-box').innerText.trim();

            if (!storyBox) {
                writeButton.innerText = 'Write';
            } else if (storyBox && !wordInput) {
                writeButton.innerText = 'Use predicted word';
            } else if (storyBox && wordInput) {
                writeButton.innerText = 'Write';
            }
        }

        function writeWord() {
            let word = document.getElementById('word-input').value.trim();
            fetch('http://localhost:8080/write', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ word: word, model_type: modelType })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('story-box').innerText = data.story;
                document.getElementById('next-word-box').innerText = data.next_word || "I will predict your next word...";
                document.getElementById('word-input').value = '';
                document.getElementById('auto-complete-box').innerText = 'Auto Complete';
                updateButtonText();
            })
            .catch(error => console.error('Error:', error));
        }

        function switchModel(type) {
            modelType = type;
            fetch('http://localhost:8080/switch', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ model_type: modelType })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('next-word-box').innerText = data.next_word || "I will predict your next word...";
                updateButtonText();
            })
            .catch(error => console.error('Error:', error));
        }

        function autoComplete() {
            let currentText = document.getElementById('word-input').value.trim();
            fetch('http://localhost:8080/auto-complete', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: currentText, model_type: modelType })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('auto-complete-box').innerText = data.suggestions.join(', ') || 'Auto Complete';
                updateButtonText();
            })
            .catch(error => console.error('Error:', error));
        }

        function endStory() {
            fetch('http://localhost:8080/end', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => {
                if (response.ok) {
                    alert('Server is shutting down...');
                    disableButtons();
                    document.getElementById('next-word-box').innerText = 'Story ended';
                    document.getElementById('auto-complete-box').innerText = 'Story ended';
                }
            })
            .catch(error => console.error('Error:', error));
        }

        function disableButtons() {
            document.getElementById('write-button').disabled = true;
            document.getElementById('bigram-button').disabled = true;
            document.getElementById('trigram-button').disabled = true;
            document.getElementById('end-button').disabled = true;
            document.getElementById('word-input').disabled = true;

            document.getElementById('write-button').classList.add('disabled');
            document.getElementById('bigram-button').classList.add('disabled');
            document.getElementById('trigram-button').classList.add('disabled');
            document.getElementById('end-button').classList.add('disabled');
        }

        // Fetch the initial next word prediction and update button text
        fetch('http://localhost:8080')
            .then(response => response.json())
            .then(data => {
                document.getElementById('next-word-box').innerText = data.next_word || "I will predict your next word...";
                updateButtonText();
            });
    </script>
</body>
</html>
